name: Test Allrun
on: 
  push:
    branches: [ "Test" ]
  pull_request:
    branches: [ "Test" ]
jobs:
  build_test:
    runs-on: ubuntu-latest      
    container: 
      image: ubuntu:20.04
    steps:
     - name: Checkout
       uses: actions/checkout@v3
     - name: initialize
       env:
        DEBIAN_FRONTEND: noninteractive
       run: |
        apt install -y --no-install-recommends 
        apt-get update 
        apt-get install -y sudo && wget && unzip && git && software-properties-common
        apt-get install -y openmpi-bin
        sudo apt-get install libopenmpi-dev
 
       
     - name: openfoam7
       env:
        DEBIAN_FRONTEND: noninteractive
       run: |
        sudo sh -c "wget -O - https://dl.openfoam.org/gpg.key | apt-key add -" 
        sudo add-apt-repository http://dl.openfoam.org/ubuntu
        sudo apt-get update
        export DEBIAN_FRONTEND=noninteractive 
        apt-get -y install openfoam7 -- no-install-recommends

     
       
     - name: libtorch
       run: |
        wget https://download.pytorch.org/libtorch/cpu/libtorch-cxx11-abi-shared-with-deps-1.11.0%2Bcpu.zip
        unzip libtorch-cxx11-abi-shared-with-deps-1.11.0+cpu.zip -d thirdParty 
        rm libtorch-cxx11-abi-shared-with-deps-1.11.0+cpu.zip 
     

     - name: clone
       run: |
        git clone https://github.com/JX278/deepflame-dev.git
        cd deepflame-dev
 

     
        
     - name: cantera and build
       run:  
        /bin/bash -c "wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh && sh Miniconda3-latest-Linux-x86_64.sh -b && source ~/miniconda3/etc/profile.d/conda.sh && conda create -n libcantera && conda activate libcantera && conda install -c cantera libcantera-devel && source /opt/openfoam7/etc/bashrc &&  . install.sh "

     - name: Allrun
       run: 
        /bin/bash -c "cd test && source ~/miniconda3/etc/profile.d/conda.sh && conda activate libcantera && source /opt/openfoam7/etc/bashrc && source /__w/deepflame-dev/deepflame-dev/bashrc && ./Allrun"
        

       
        
    





